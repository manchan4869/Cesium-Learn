import"./modulepreload-polyfill-ec808ebb.js";import{c as D}from"./accessToken-5e40def6.js";/* empty css             *//* empty css                      */class b{constructor(n,u=.003){this.scene_=n,this.movementFactor_=u,this.movementX_=0,this.movementY_=0;const r=this.onMouseMove_.bind(this),d=this.onPostRender_.bind(this);document.addEventListener("pointerlockchange",_=>{this.active?(document.addEventListener("mousemove",r),this.scene_.postRender.addEventListener(d)):(document.removeEventListener("mousemove",r),this.scene_.postRender.removeEventListener(d))}),document.addEventListener("pointerlockerror",_=>{console.error(_)})}get active(){return document.pointerLockElement!==null}set active(n){n&&this.scene_.canvas.requestPointerLock()}onMouseMove_(n){n.movementX&&n.movementY&&(this.movementX_+=n.movementX,this.movementY_+=n.movementY,this.scene_.requestRender())}onPostRender_(){const n=this.scene_.camera,u=n.heading+this.movementX_*this.movementFactor_;this.movementX_=0;const r=n.pitch-this.movementY_*this.movementFactor_;this.movementY_=0,n.setView({orientation:{heading:u,pitch:r}})}}Cesium.FirstPersonCameraController=function(){const t=Cesium.Cartesian3;let n=-1;const u=0,r=1,d=2,_=3,T=1.5,E=1.65,m=88,f=-5;function o(e){this._enabled=!1,this._cesiumViewer=e.cesiumViewer,this._canvas=this._cesiumViewer.canvas,this._camera=this._cesiumViewer.camera,this._connectEventHandlers()}o.prototype._connectEventHandlers=function(){const e=this._cesiumViewer.canvas;this._screenSpaceEventHandler=new Cesium.ScreenSpaceEventHandler(this._canvas),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOWN),this._screenSpaceEventHandler.setInputAction(this._onMouseUp.bind(this),Cesium.ScreenSpaceEventType.LEFT_UP),this._screenSpaceEventHandler.setInputAction(this._onMouseMove.bind(this),Cesium.ScreenSpaceEventType.MOUSE_MOVE),this._screenSpaceEventHandler.setInputAction(this._onMouseLButtonDoubleClicked.bind(this),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.setAttribute("tabindex","0"),e.onclick=function(){e.focus()},e.addEventListener("keydown",this._onKeyDown.bind(this)),e.addEventListener("keyup",this._onKeyUp.bind(this)),this._disconectOnClockTick=this._cesiumViewer.clock.onTick.addEventListener(o.prototype._onClockTick,this)},o.prototype._onMouseLButtonClicked=function(e){this._looking=!0,this._mousePosition=this._startMousePosition=t.clone(e.position)},o.prototype._onMouseLButtonDoubleClicked=function(e){this._looking=!0,this._mousePosition=this._startMousePosition=t.clone(e.position)},o.prototype._onMouseUp=function(e){this._looking=!1},o.prototype._onMouseMove=function(e){this._mousePosition=e.endPosition},o.prototype._onKeyDown=function(e){const i=e.keyCode;switch(this._direction=n,i){case"W".charCodeAt(0):this._direction=u;return;case"S".charCodeAt(0):this._direction=r;return;case"D".charCodeAt(0):this._direction=_;return;case"A".charCodeAt(0):this._direction=d;return;case 90:return;default:return}},o.prototype._onKeyUp=function(){this._direction=n},o.prototype._changeHeadingPitch=function(e){let i=this._canvas.clientWidth,a=this._canvas.clientHeight,c=(this._mousePosition.x-this._startMousePosition.x)/i,s=-(this._mousePosition.y-this._startMousePosition.y)/a,h=Cesium.Math.toDegrees(this._camera.heading),C=c*f,k=h+C,M=Cesium.Math.toDegrees(this._camera.pitch),P=s*f,l=M+P;console.log("rotationSpeed: "+f+" deltaY: "+s+" deltaPitchInDegree"+P),l>m*2&&l<360-m?l=360-m:l>m&&l<360-m&&(l=m),this._camera.setView({orientation:{heading:Cesium.Math.toRadians(k),pitch:Cesium.Math.toRadians(l),roll:this._camera.roll}})};let p=new t,y=new t,S=new t,w=new t,g=new Cesium.Cartographic;return o.prototype._onClockTick=function(e){if(!this._enabled)return;let i=e._clockStep;if(this._looking&&this._changeHeadingPitch(i),this._direction===n)return;let a=this._walkingSpeed()*i;this._direction===u?t.multiplyByScalar(this._camera.direction,1,p):this._direction===r?t.multiplyByScalar(this._camera.direction,-1,p):this._direction===d?t.multiplyByScalar(this._camera.right,-1,p):this._direction===_&&t.multiplyByScalar(this._camera.right,1,p),t.multiplyByScalar(p,a,y);let c=this._camera.position;t.add(c,y,S);let s=this._cesiumViewer.scene.globe,h=s.ellipsoid;h.cartesianToCartographic(S,g);let C=s.getHeight(g);if(C===void 0){console.warn("height is undefined!");return}C<0&&console.warn("height is negative!"),g.height=C+E,h.cartographicToCartesian(g,w),this._camera.setView({destination:w,orientation:new Cesium.HeadingPitchRoll(this._camera.heading,this._camera.pitch,this._camera.roll),endTransform:Cesium.Matrix4.IDENTITY})},o.prototype._walkingSpeed=function(){return T},o.prototype._enableDefaultScreenSpaceCameraController=function(e){const i=this._cesiumViewer.scene;i.screenSpaceCameraController.enableRotate=e,i.screenSpaceCameraController.enableTranslate=e,i.screenSpaceCameraController.enableZoom=e,i.screenSpaceCameraController.enableTilt=e,i.screenSpaceCameraController.enableLook=e},o.prototype.start=function(){console.log(this),this._enabled=!0,this._enableDefaultScreenSpaceCameraController(!1);let e=this._camera.position,i=new Cesium.Cartographic,a=this._cesiumViewer.scene.globe;a.ellipsoid.cartesianToCartographic(e,i);let c=a.getHeight(i);if(c===void 0)return!1;c<0&&console.warn("height is negative"),i.height=c+E;let s=new t;a.ellipsoid.cartographicToCartesian(i,s);let h=this._camera.heading;return this._heading=h,this._camera.flyTo({destination:s,orientation:{heading:h,pitch:Cesium.Math.toRadians(0),roll:0}}),!0},o.prototype.stop=function(){this._enabled=!1,this._enableDefaultScreenSpaceCameraController(!0)},o}();Cesium.Ion.defaultAccessToken=D;const v=new Cesium.Viewer("cesiumContainer",{terrainProvider:Cesium.createWorldTerrain()});v.scene.primitives.add(Cesium.createOsmBuildings());v.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(115.036,30.2,2e3),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-45)}});const I=document.querySelector(".btn.btn-primary"),L=document.querySelector(".btn.btn-success"),H=new b(v.scene),R=new Cesium.FirstPersonCameraController({cesiumViewer:v});I.addEventListener("click",()=>{H.active=!0});const A=(()=>{let t=!1;return()=>(t=!t,t)})();L.addEventListener("click",()=>{R[{true:"start",false:"stop"}[A()]]()});
